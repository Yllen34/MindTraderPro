<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Journal de Trading - Interface Avancée</title>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <style>
        body {
            background-color: #121212;
            color: #fff;
            padding: 2rem;
            font-family: 'Segoe UI', sans-serif;
        }
        .form-control, .btn {
            border-radius: 0.4rem;
        }
        .container {
            max-width: 1200px;
            margin: auto;
        }
        h1, h2 {
            color: #00d1b2;
        }
        table.dataTable {
            background-color: #1f1f1f;
            color: white;
        }
        label, input, select {
            color: white;
        }
        .dataTables_wrapper .dataTables_filter input {
            color: black;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>Journal de Trading</h1>

    <h2>Ajouter un Trade</h2>
    <form id="tradeForm" class="row g-3" onsubmit="submitTrade(event)">
        <div class="col-md-4">
            <label for="presetPairs" class="form-label">Paire prédéfinie</label>
            <select class="form-control" id="presetPairs" onchange="updateCustomPair(this.value)">
                <option value="">-- Choisir une paire --</option>
                <option value="EURUSD">EURUSD</option>
                <option value="GBPUSD">GBPUSD</option>
                <option value="USDJPY">USDJPY</option>
                <option value="XAUUSD">XAUUSD</option>
                <option value="NAS100">NAS100</option>
                <option value="US30">US30</option>
                <option value="BTCUSD">BTCUSD</option>
                <option value="ETHUSD">ETHUSD</option>
            </select>
        </div>
        <div class="col-md-4">
            <label for="customPair" class="form-label">Paire personnalisée</label>
            <input type="text" class="form-control" id="customPair" oninput="updateCustomPair(this.value)">
        </div>
        <input type="hidden" id="paire" required>

        <div class="col-md-2"><input type="text" class="form-control" id="type" placeholder="Type" required></div>
        <div class="col-md-2"><input type="number" step="0.01" class="form-control" id="lot" placeholder="Lot" required></div>
        <div class="col-md-2"><input type="number" step="0.01" class="form-control" id="entry" placeholder="Entrée" required></div>
        <div class="col-md-2"><input type="number" step="0.01" class="form-control" id="sl" placeholder="SL" required></div>
        <div class="col-md-2"><input type="number" step="0.01" class="form-control" id="tp" placeholder="TP" required></div>
        <div class="col-md-2"><input type="number" step="0.01" class="form-control" id="rr" placeholder="RR" required></div>
        <div class="col-md-2"><input type="number" step="0.01" class="form-control" id="gain" placeholder="Gain" required></div>
        <div class="col-md-3"><input type="text" class="form-control" id="note" placeholder="Note"></div>
        <div class="col-md-3"><input type="text" class="form-control" id="tag" placeholder="Tag"></div>
        <div class="col-md-2"><button type="submit" class="btn btn-success mt-2">Ajouter</button></div>
    </form>

    <h2 class="mt-5">Liste des Trades</h2>
    <table id="tradesTable" class="display nowrap" style="width:100%">
        <thead>
        <tr>
            <th>Paire</th><th>Type</th><th>Lot</th><th>Entrée</th><th>SL</th><th>TP</th><th>RR</th><th>Gain</th><th>Note</th><th>Tag</th>
        </tr>
        </thead>
        <tbody id="tradesBody"></tbody>
    </table>
</div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script>
    function updateCustomPair(value) {
        document.getElementById("paire").value = value.toUpperCase();
    }

    function submitTrade(event) {
        event.preventDefault();
        const data = {
            paire: document.getElementById("paire").value,
            type: document.getElementById("type").value,
            lot: parseFloat(document.getElementById("lot").value),
            entry: parseFloat(document.getElementById("entry").value),
            sl: parseFloat(document.getElementById("sl").value),
            tp: parseFloat(document.getElementById("tp").value),
            rr: parseFloat(document.getElementById("rr").value),
            gain: parseFloat(document.getElementById("gain").value),
            note: document.getElementById("note").value,
            tag: document.getElementById("tag").value
        };
        fetch("/api/journal", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data)
        }).then(response => response.json()).then(data => {
            alert("Trade ajouté !");
            loadTrades();
        });
    }

    function loadTrades() {
        fetch("/api/journal")
            .then(response => response.json())
            .then(data => {
                let body = '';
                data.forEach(t => {
                    body += `<tr>
                        <td>${t.paire}</td><td>${t.type}</td><td>${t.lot}</td><td>${t.entry}</td>
                        <td>${t.sl}</td><td>${t.tp}</td><td>${t.rr}</td><td>${t.gain}</td>
                        <td>${t.note}</td><td>${t.tag}</td>
                    </tr>`;
                });
                document.getElementById("tradesBody").innerHTML = body;
                $('#tradesTable').DataTable();
            });
    }

    window.onload = loadTrades;
</script>
</body>
</html>